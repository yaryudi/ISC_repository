<!DOCTYPE html>
<!--
체팅  예제 - 버튼을 누르면 현재 자신이 속해있는 채팅방으로 이동
채팅방 접속 시 대화내용이 불러와지는 지 테스트 
 -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- jQuery 라이브러리 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <!--jquery cookie를 사용하기 위해-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

 <body>
  <h3 style='color: #ccc;font-size: 30px;'>THIS IS OUT OF CHAT ROOM</h3>
  <div class="message_holder"></div>
  <form action="" method="POST">
    <!--type:에 submit시 제출 기능과 go_inroom 기능과 충돌하여 오류가 발생가능-->
    <button type="button" onclick="go_inroom()">채팅 방 입장</button>
    <button type="button" onclick="logout()">로그아웃</button>
    <input type="text" class="username" style='font-size:15px;' placeholder="friend's Name"/>
  </form>
</body>

<script>
  function go_inroom() {
    window.location.href = '/inroom'
}

  function logout() {
  // 먼저 인증 여부를 확인
  $.ajax({
      type: "GET",
      url: "/api/isAuth",
      success: function (response) {
          if (response['result'] === 'success') {
              // 인증이 확인된 경우 로그아웃 요청을 보냄
              $.ajax({
                  type: "POST",
                  url: "/api/logout",
                  success: function (response) {
                      if (response['result'] === 'success') {
                          alert(response['msg']);
                          window.location.href = '/';  // 홈 화면으로 리디렉션
                      } else {
                          alert('로그아웃 중 오류가 발생했습니다.');
                      }
                  },
                  error: function () {
                      alert('서버와 통신 중 오류가 발생했습니다.');
                  }
              });
          } else {
              // 인증이 실패한 경우 로그인 화면으로 리디렉션
              alert(response['msg']);
              window.location.href = '/';
          }
      },
      error: function () {
          alert('서버와 통신 중 오류가 발생했습니다.');
      }
  });
}



//function finduser_inroom()
//채팅 입장 버튼을 눌렀을 시 -> jwt토큰의 정보를 기반으로 DB에서 수색
//없을 시 데이터 생성
//있을 시 해당 방에 입장


//입장 전, 대화방의 jwt 토큰을 클라이언트에 줌
//즉, 클라이언트는 사용자인증 토큰 + 대화방인증 토큰 -> 2개를 보유하고 inroom으로 간다.

</script>